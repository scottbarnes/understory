{% extends 'base.html' %}

{% load wagtailcore_tags wagtailimages_tags %}

{% block body_class %}template-five_questionsindexpage{% endblock %}

{% block content %}
  <main role="main">
    <div class="container">
      <h1>{{ page.title }}</h1>

      {% comment %}
	<div class="intro">{{ page.intro|richtext }}</div>
      {% endcomment %}
      <br />

      <div class="featured-resources row">

	{% for five_questions in five_questionspages %}
	  {% with five_questions=five_questions.specific title=five_questions.title|upper %}
	    {% if five_questions.language == "English" and five_questions.is_suppressed == False %}
	      <div class="col-md-4">
		<a href="{% pageurl five_questions %}">
		  <figure>
		    {% image five_questions.lead_image fill-430x254-c100 alt=five_questions.lead_image_alt_text %}
		  </figure>
		  <h3>
		    <span class="line-spacing">
		      {{ title|safe }}
		    </span>
		</a>
		{% with num_of_authors=five_questions.authors.count %}
		  {% if num_of_authors == 1%}
		    <br />by {{ five_questions.authors.first.author.name }}
		  {% elif num_of_authors == 2 %}
		    <br />by {{ five_questions.authors.all.0.author.name }}
		    and
		    {{ five_questions.authors.all.1.author.name }}
		  {% elif num_of_authors > 2 %}
		    <br />by
		    {% for iter in five_questions.authors.all %}
		      {% if iter == five_questions.authors.last %}
			and {{ iter.author.name }}
		      {% else %}
			{{ iter.author.name }},&nbsp;
		      {% endif %}
		    {% endfor %}
		  {% endif %}

		{% endwith %}

		  </h3>
		  {% comment %}
		    Go through the translation queryset and for each translation make a link
		    to the translated five_questions. But if there are no translations output a
		    linebreak (in place of <p> which would have done that if there were
		    a translation).
		  {% endcomment %}
		  {% if five_questions.translations.all %} {# .all filters out empty querysets #}
		    {% with num_of_translations=five_questions.translations.count %}
		      <p style="text-align: center">Also available in
		      {# When there is one translation just link it. #}
		      {% if num_of_translations == 1 %}
			{% with translation=five_questions.translations.all.0 %} {# get first index #}
			  <a href="{% pageurl translation %}">{{ translation.language }}</a>
			{% endwith %}
			{# With two translations link both joined with a conjunction. #}
		      {% elif num_of_translations == 2 %}
			{% with translation=five_questions.translations.all %}
			  <a href="{% pageurl translation.0 %}">{{ translation.0.language }}</a>
			  and
			  <a href="{% pageurl translation.1 %}">{{ translation.1.language }}</a>
			{% endwith %}
		      {% else %}
			{% comment %}
			  For all of the translations, if the element is the last of the translations, print:
			  "and <language>". Otherwise, print "<language>,"
			{% endcomment %}
			{% for translation in five_questions.translations.all %}
			  {% with translation=translation.specific %}
			    {% if translation == five_questions.translations.all.last %}
			      and <a href="{% pageurl translation %}">{{ translation.language }}</a>
			    {% else  %}
			      <a href="{% pageurl translation %}">{{ translation.language }}</a>, {# comma #}
			    {% endif %}
			  {% endwith %}
			{% endfor %}
		      {% endif %}
		      </p>
		      <br /> {# Add lines between stories with translations. #}
		    {% endwith %}
		  {% else %} {# If no five_questionss in five_questions.translations.all, enter a linebreak in place of <p> #}
		    <br />
		    <br /> {# Add lines between stories with no translations. #}
		  {% endif %}
		  <br />
	      </div>
	    {% endif %}
	  {% endwith %}
	{% endfor %}

      </div>
    </div>
  </main>
{% endblock %}
